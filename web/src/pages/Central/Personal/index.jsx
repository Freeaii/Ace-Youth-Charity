import React, {Component} from 'react';
import './index.css'
import {Link,Route,Switch,Redirect} from "react-router-dom";
import Manage from "./Manage";
import P_center from "./Personal_center";
import Creation from "./Creation";
import Admin from "./Admin";
import Notice from "./Notice";
import axios from "axios";
class Personal extends Component {
    state={
        personal_menu:[
            {
                id:1000,
                address:"/personal/creation",
                d:"M896 864a32 32 0 0 1 0 64H128a32 32 0 0 1 0-64z m-60.16-733.621333l15.093333 15.093333c45.866667 45.834667 45.866667 120.16 0 166.005333L418.794667 743.338667a160.192 160.192 0 0 1-78.122667 42.986666l-152.245333 34.197334c-23.84 5.365333-44.661333-16.853333-37.749334-40.288l43.338667-146.88a160.042667 160.042667 0 0 1 40.373333-67.925334l435.328-435.050666c45.866667-45.834667 120.245333-45.834667 166.112 0zM636.32 254.304L279.68 610.709333a96.021333 96.021333 0 0 0-24.213333 40.746667l-27.946667 94.656 99.093333-22.261333a96.117333 96.117333 0 0 0 46.869334-25.781334L726.933333 344.842667l-90.602666-90.538667z m78.698667-78.656l-33.397334 33.386667 90.602667 90.538666 33.386667-33.376a53.333333 53.333333 0 0 0 0-75.456l-15.093334-15.093333a53.408 53.408 0 0 0-75.498666 0z",
                name:"创作"
            },
            {
                id:1002,
                address:"/personal/manage",
                d:"M800 736H448a32 32 0 0 0 0 64h352a32 32 0 0 0 0-64zM800 480H448a32 32 0 0 0 0 64h352a32 32 0 0 0 0-64zM800 224H448a32 32 0 0 0 0 64h352a32 32 0 0 0 0-64zM304 736h-64a32 32 0 0 0 0 64h64a32 32 0 0 0 0-64zM304 480h-64a32 32 0 0 0 0 64h64a32 32 0 0 0 0-64zM304 224h-64a32 32 0 0 0 0 64h64a32 32 0 0 0 0-64z",
                name:"管理"
            },
            {
                id:1005,
                address:"/personal/notice",
                d:"M192.032 631.402667V404.725333C192.032 228.330667 335.285333 85.333333 512 85.333333s319.968 142.997333 319.968 319.392v226.677334l60.608 121.013333c10.645333 21.237333-4.832 46.218667-28.618667 46.218667H160.042667c-23.786667 0-39.253333-24.981333-28.618667-46.218667l60.608-121.013333z m620.16 103.36l-40.842667-81.536a31.893333 31.893333 0 0 1-3.381333-14.282667V404.725333c0-141.12-114.602667-255.509333-255.968-255.509333S256.032 263.605333 256.032 404.725333V638.933333c0 4.96-1.162667 9.845333-3.381333 14.293334l-40.842667 81.525333h600.384z m-443.306667 152.32a31.893333 31.893333 0 0 1-4.149333-44.981334 32.032 32.032 0 0 1 45.056-4.138666A159.36 159.36 0 0 0 512 874.773333a159.36 159.36 0 0 0 102.186667-36.8 32.032 32.032 0 0 1 45.056 4.138667 31.893333 31.893333 0 0 1-4.16 44.981333A223.402667 223.402667 0 0 1 512 938.666667c-52.981333 0-103.2-18.453333-143.114667-51.594667z",
                name:"通知"
            },
            {
                id:1003,
                address:"/personal/p_center",
                d:"M872.554667 306.304c-22.613333 8.128-45.696 9.941333-69.162667 4.373333a119.722667 119.722667 0 0 1-85.504-158.144c1.749333-4.842667 0.853333-6.954667-3.605333-8.96-17.92-8.106667-35.541333-16.917333-53.674667-24.533333-11.925333-4.992-24.533333-8.384-36.501333-12.373333-23.146667 47.658667-59.456 74.88-112.064 74.88-52.821333 0-89.258667-27.306667-111.978667-74.538667a411.733333 411.733333 0 0 0-95.530667 39.573333c17.216 49.493333 10.922667 94.634667-26.538666 131.925334-37.376 37.205333-82.496 43.712-131.776 26.282666A413.290667 413.290667 0 0 0 106.666667 400.298667c46.933333 22.656 74.197333 58.666667 74.517333 110.997333 0.32 53.162667-26.986667 89.770667-74.538667 112.768a410.154667 410.154667 0 0 0 39.637334 95.530667c47.808-16.789333 91.669333-11.370667 128.64 23.253333 39.957333 37.44 47.274667 83.626667 29.653333 134.933333a404.949333 404.949333 0 0 0 95.530667 39.466667c23.04-47.36 59.349333-74.474667 111.978666-74.453333 52.885333 0.064 89.216 27.541333 111.893334 74.538666a411.584 411.584 0 0 0 95.488-39.616c-17.386667-49.493333-10.816-94.4 26.24-131.626666 37.290667-37.418667 82.432-43.776 132.053333-26.538667a407.637333 407.637333 0 0 0 39.509333-95.509333c-47.786667-23.210667-74.986667-59.946667-74.517333-113.066667 0.448-52.053333 27.562667-87.957333 74.56-110.656a420.394667 420.394667 0 0 0-38.016-92.970667c-2.048-3.712-4.309333-1.92-6.762667-1.066666z m85.952 82.794667a42.666667 42.666667 0 0 1-22.613334 49.642666c-34.602667 16.725333-50.176 39.146667-50.453333 72.618667-0.298667 34.282667 15.253333 57.194667 50.496 74.304a42.666667 42.666667 0 0 1 22.549333 49.536 450.304 450.304 0 0 1-43.669333 105.472 42.666667 42.666667 0 0 1-51.050667 19.178667c-36.650667-12.736-63.850667-7.68-87.808 16.362666-23.914667 24.021333-28.949333 51.093333-16.213333 87.381334a42.666667 42.666667 0 0 1-19.072 51.178666 454.229333 454.229333 0 0 1-105.344 43.690667 42.666667 42.666667 0 0 1-49.770667-22.592c-16.725333-34.688-39.509333-50.368-73.493333-50.389333-33.92-0.021333-56.597333 15.509333-73.578667 50.432a42.666667 42.666667 0 0 1-49.322666 22.570666 447.338667 447.338667 0 0 1-105.6-43.562666 42.666667 42.666667 0 0 1-19.328-50.986667c13.034667-37.973333 7.381333-65.728-18.474667-89.941333-23.594667-22.101333-50.090667-26.517333-85.333333-14.144a42.666667 42.666667 0 0 1-51.157334-19.050667 452.821333 452.821333 0 0 1-43.733333-105.450667 42.666667 42.666667 0 0 1 22.549333-49.706666c35.072-16.938667 50.666667-39.808 50.453334-74.069334-0.213333-33.642667-15.786667-56.149333-50.389334-72.853333A42.666667 42.666667 0 0 1 65.493333 389.12a455.808 455.808 0 0 1 43.541334-105.344 42.666667 42.666667 0 0 1 51.392-19.242667c36.096 12.778667 63.317333 7.722667 87.466666-16.298666 24-23.893333 29.034667-51.072 16.32-87.68a42.666667 42.666667 0 0 1 19.178667-51.050667 454.4 454.4 0 0 1 105.386667-43.669333 42.666667 42.666667 0 0 1 49.706666 22.656c16.725333 34.730667 39.509333 50.389333 73.536 50.368 33.898667 0 56.576-15.616 73.664-50.837334a42.666667 42.666667 0 0 1 51.882667-21.845333c2.517333 0.832 4.992 1.621333 9.28 2.965333l7.530667 2.346667c8.96 2.88 15.786667 5.290667 22.698666 8.192 10.154667 4.245333 18.090667 7.872 35.029334 15.829333 10.069333 4.736 14.4 6.741333 19.733333 9.152 25.024 11.306667 35.349333 36.821333 26.154667 62.336-16 44.352 9.344 91.221333 55.253333 102.144 14.805333 3.52 29.418667 2.538667 44.864-3.029333a33.28 33.28 0 0 1 4.48-1.621333c5.269333-1.621333 10.88-2.453333 17.322667-1.941334 16.853333 1.344 29.525333 11.093333 36.736 24.170667a462.890667 462.890667 0 0 1 41.813333 102.357333zM522.666667 320a202.666667 202.666667 0 1 0 166.4 86.954667 21.333333 21.333333 0 0 0-35.008 24.384 160 160 0 1 1-69.184-56.128 21.333333 21.333333 0 0 0 16.597333-39.317334A202.090667 202.090667 0 0 0 522.666667 320z",
                name:"设置"
            },
            {
                id:1004,
                address:"/personal/admin",
                d:"M695.466667 793.6l119.466666-119.466667 29.866667 29.866667-149.333333 149.333333-4.266667-4.266666-89.6-89.6 29.866667-29.866667 64 64zM554.666667 810.666667v42.666666H213.333333v-136.533333L332.8 597.333333h311.466667l46.933333 46.933334-29.866667 29.866666-29.866666-34.133333H349.866667L256 733.866667V810.666667h298.666667z m128-448c0 106.666667-85.333333 192-192 192S298.666667 469.333333 298.666667 362.666667 384 170.666667 490.666667 170.666667 682.666667 256 682.666667 362.666667z m-42.666667 0C640 281.6 571.733333 213.333333 490.666667 213.333333S341.333333 281.6 341.333333 362.666667 409.6 512 490.666667 512 640 443.733333 640 362.666667z",
                name:"管理员"
            },

        ],
        menu:[],
        account_type:"",
        admin:false,
    }
    pathJudge=(pathname)=>{
        return window.location.pathname.includes(pathname);
    }

    componentWillMount() {
        if(this.props.headerState!==1){
            this.props.history.push('/home')
            this.props.changeLoginState(0)
        }
    }

    shouldComponentUpdate(nextProps, nextState, nextContext) {
        if(this.props.headerState!==1){
            this.props.history.push('/home')
            return false
        }else {
            return true
        }
    }

    componentDidMount() {
        let {personal_menu}=this.state
        new Promise(((resolve, reject) => {
            axios.get('/api/user/information').then(res=>{
                let {account_type}=res.data
                if(account_type==="个人"){
                    this.setState({
                        account_type,
                        menu:[personal_menu[3]]
                    })
                }else {
                   resolve(res.data)
                }

            })
        })).then(resolve=>{
            let {account_type}=resolve
            axios.get('/api/user/admin').then(res=>{
                this.setState({
                    account_type,
                    menu:personal_menu,
                    admin:true,
                })
            },err=>{
                this.setState({
                    account_type,
                    menu:personal_menu.slice(0,4)
                })
            })
        })
    }

    render() {
        let {menu,account_type,admin}=this.state
        return (
            <div className="personal_page">
                <div className="personal_content">
                    <nav className="personal_menu">
                        <ul>
                            {
                                menu.map((personalObj)=>{
                                    return(
                                        <Link to={personalObj.address} key={personalObj.id}>
                                            <li>
                                                <svg viewBox="0 0 1024 1024"
                                                     xmlns="http://www.w3.org/2000/svg" style={{fill:this.pathJudge(personalObj.address)?"red":""}}>
                                                    <path
                                                        d={personalObj.d}   />
                                                </svg>
                                                <span style={{color:this.pathJudge(personalObj.address)?"red":""}}>{personalObj.name}</span>
                                            </li>
                                        </Link>
                                    )
                                })
                            }
                        </ul>
                    </nav>
                    <div className="content_show">
                        {
                            account_type==="个人"?<Switch>
                                <Route path="/personal/p_center" component={P_center}/>
                                <Redirect to="/personal/p_center"/>
                            </Switch>: <Switch>
                                <Route path="/personal/creation" component={Creation}/>
                                <Route path="/personal/manage" component={Manage}/>
                                <Route path="/personal/p_center" component={P_center}/>
                                <Route path="/personal/notice" component={Notice}/>
                                {
                                    admin? <Route path="/personal/admin" component={Admin}/>:null
                                }
                                <Redirect to="/personal/creation"/>
                            </Switch>
                        }
                    </div>
                </div>
            </div>
        );
    }
}

export default Personal;